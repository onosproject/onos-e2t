#!/bin/sh

usage() {
   echo "This script splits generated by ASN1C tool structure e2ap-v01.00.00.proto into 6 different files (with regard to their category)."
   echo "Example of usage:"
   echo "./csplit-protos.sh [-h] fileName"
   echo
   echo "[-h] --> Print this Help."
   echo
   echo "For full compliance with BSD-based OS (like MacOS) please do following:"
   echo "   1) brew install coreutils"
   echo "   2) Uncomment line 33 of this script and use gcsplit instead"
   echo "OR"
   echo "   Uncomment line 32 and observe error each time (but script would work perfectly fine)"
   echo "See more:"
   echo "https://stackoverflow.com/questions/4323703/looking-for-correct-regular-expression-for-csplit"
   exit $1
}

fatal() {
   #echo error: $*
   usage 1
}

[ "$1" = -h ] && usage 0

[ $# -lt 1 ] && fatal Input file is missing

SPLITFILE=$1 #"e2ap-v01.00.00.proto"

FILESNUMEBER=$(csplit -sk ${SPLITFILE} '/\/\/\/\/\//' '{*}' | wc -l)
#FILESNUMEBER=$(csplit -sk ${SPLITFILE} '/\/\/\/\/\//' '{999999999}' | wc -l)
#FILESNUMEBER=$(gcsplit -sk ${SPLITFILE} '/\/\/\/\/\//' '{*}' | wc -l)
echo "${FILESNUMEBER} files were created"

for f in xx*;
do
  FILENAME=$(cat $f | grep -oE '[A-Za-z0-9\-]*\.proto' | awk 'FNR <= 1')
  mv $f $FILENAME
done
